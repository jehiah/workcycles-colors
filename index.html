<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Workcycle RAL Color Selector</title>
    <style type="text/css">
body {
  background-color: #f0f0f0;
  font-family: sans-serif;
}
svg {
  vertical-align: middle;
}
nav {
  display: block;
  background-color: #fff;
  padding: 1rem;
  margin-bottom: 1rem;
}

h1 {
  display: inline-block;
  /*font-family: 'Source Sans Pro';*/
  font-family: sans-serif;
  font-size: 36px;
  font-weight: 700;
  margin: 0;
  padding: 0;
}
.frame {
  display: inline-block;
  border: 5px solid #fff;
  background-color: #fff;
  margin: 5px;
}
.frame.inactive {
  border: 5px solid #f0f0f0;
}
.frame > img {
  height:  200px;
  display: block;
}
.frame.inactive > img {
  opacity: .25;
  transition-property: opacity;
  transition-duration: 200ms;
}

.frame.inactive > .attribution > .ral {
  opacity: .25;
  transition-property: opacity;
  transition-duration: 200ms;
}

.thumbnail {

}
.attribution {
  display: block;
  margin: 3px 0 0 0;
  font-size: 12px;
  height: 20px;
}

.float-right {
  float: right;
}
.external-link {
  color: #006437;
  font-weight: 600;
  font-size: 18px;
}
.selector {
  display: inline-block;
  width: 50px;
  height: 20px;
  font-size: 12px;
  line-height: 20px;
  padding: 0 .2rem;
  margin: 2px;
  border: 2px solid #fff;
  cursor: pointer;
}
.selector:hover {
  border: 2px solid #666;
}

.ral {
  width: 16px;
  height: 16px;
  border: 2px solid #fff;
  display: inline-block;
  cursor: pointer;
}
.ral:hover {
  border: 2px solid #666;
}


a.src {
  display: inline-block;
  margin-left: .5rem;
  font-size: 12px;
  line-height: 16px;
  color: #333;
  text-decoration: underline;
  vertical-align: top;
}
      
    </style>
  </head>
  <body>
<nav>
  <h1>Workcycle RAL Color Selector</h1>
  <a href="https://workcycles.com/" class="float-right external-link"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg> workcycles.com</a>
</nav>

<div id="summary">Interested in buying a Workcycle Fr8, Gr8 or Kr8 with custom <a href="https://www.ralcolor.com/">RAL colors</a>? Here are some unique color combinations from happy customers.</div>

<div id="ral"></div>
<div id="images"></div>

<script type="module">

import * as d3 from "https://cdn.skypack.dev/d3@7";
import {json} from "https://cdn.skypack.dev/d3-fetch@3";

const images = d3.selectAll("#images");
const colors = new Set();
const selectedColors = new Set();
const ral_colors = {
  "RAL1028": "#FFAB01",
  "RAL3018": "#E6244B",
  "RAL5018": "#48D5EB", //"#3E898F", ?
  "RAL6029": "#327E43",
  "RAL5012": "#3682BA",
  "RAL5015": "#2270B1",
  "RAL7022": "#4D4943",
  "RAL2004": "#E35403",
}

let ral =   d3.select("#ral").selectAll("div.selector");
let frames = d3.select("#images").selectAll("div.frame");
let sourceData = null;
json("bikes.json").then((data) => {
  data.forEach(d => {
    if (typeof(d.color) == "string") {d.color = [d.color]}
    d.color.forEach(dd => colors.add(dd))
  })
  sourceData = data;
  renderColors();
  updateImages(sourceData);
})

function selectColor(_, c) {
  if (selectedColors.has(c)) {
    selectedColors.delete(c)
  } else {
    selectedColors.add(c)
  }
  console.log("selectedColors", selectedColors)
  d3.select("#images").selectAll("div.frame")
  .classed("inactive", d => selectedColors.size != 0 && ! d.color.some(dd => selectedColors.has(dd)))
}

function renderColors() {
  ral.data(colors).join("div")
  .attr("class", "selector")
  .style("background-color", d => ral_colors[d])
  .attr("title", d => d)
  // .data("color")
  .text( d => d)
  .on("click", selectColor)
}

function updateImages(data) {
  let f  = frames.data(data)
  .join("div")
  .attr("class", "frame")

  f.append("img")
  .attr("src", d => d.image)  
  // .attr("width", 200)
  // .attr("height", 200)
  .attr("class", "thumbnail")

  let attribution = f.append("div")
  .attr("class", "attribution")

  attribution.selectAll("div.ral")
  .data(d => d.color)
  .join("div")
  .attr("class", "ral")
  .style("background-color", d => {return ral_colors[d]})
  .attr("title", d => d)
  .on("click", selectColor)

  attribution.append("a")
    .attr("class", "src")
    .attr("href", d => d.src)
    .text(d => d.copyright)
}

</script>


  </body>
</html>